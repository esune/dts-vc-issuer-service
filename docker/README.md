[Version Fran√ßaise](README_fr-ca.md)

# Running the DTS VC Issuer Service

To run the project you will need to open two terminals:

- one terminal in the [ngrok](./ngrok) folder: run the [start-ngrok.sh](./ngrok/start-ngrok.sh) script, this will initialize an ngrok tunnel that will be used to forward requests to your agent.

- one terminal in the [docker](./docker) folder: run `./manage build` command to compile the image pre-requisites to run the services, then `./manage start`. This will start all of the services defined in [docker-compose.yml](./docker/docker-compose.yml).

Once started the services will be listening on localhost as follows:

- `immunization-api-dev`: http://localhost:5001 - running in dev mode with hot-reloading.

- `issuer-api-dev`: http://localhost:5000 - running in dev mode with hot-reloading.

- `frontend`: http://localhost:4200 - running in dev mode with hot reloading.

- `agent`: http://localhost:8024 (admin API) and http://localhost:8021 (public endpoint, also exposed on the ngrok URL).

- `db` and `wallet` postgres databases will respectively be listening on ports `5432` and `5434`.

You can always run `./manage -h` to get more information about the usage of the script, and refer to it to find values for environment variables being set and consumed by `docker-compose`.

**Please Note:** when starting the project, a `.env` file containing the agent wallet seed will be generated in the [docker](./docker) folder. Do not edit this file manually, as its contents are used by the services to persist the agent's information and will be handled automatically by the `manage` script.

## Using custom service ports

When starting the project, the services will use reasonable defaults (see previous section) to bind ports and expose them to the host. In rare situations, the ports might already be in use and cause issues when starting up.

In this case, each port binding can be individually overridden by using an environment variable:

- `immunization-api-dev`: use environment variable `IMMUNIZATION_API_PORT`.

- `issuer-api-dev`: use environment variable `ISSUER_API_PORT`.

- `frontend`: use environment variable `FRONTEND_WEB_PORT`.

- `agent`: use `AGENT_ADMIN_PORT` for the admin API and `AGENT_HTTP_IN_PORT` for the public endpoint. Additionally, `AGENT_WS_IN_PORT` can be used for the websocket endpoint.

- `db`: use `EXPOSED_DATABASE_PORT`.

- `wallet` use `EXPOSED_WALLET_PORT`.

An example for the project started with custom agent ports for admin API and public endpoints:

```bash
AGENT_ADMIN_PORT=8088 AGENT_HTTP_IN_PORT=8089 ./manage start
```

Environment variables can also be exported in the current shell session: this can be used to set them once and then only execute `./manage start` to run or restart the services.
